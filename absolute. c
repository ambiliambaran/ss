#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main() {
    FILE *obj;
    char ch, ch1, pname[10];
    int start, length, locctr = 0;

    // open object program file
    obj = fopen("objcode.txt", "r");
    if (obj == NULL) {
        printf("Could not open file.\n");
        return 1;
    }

    // read till end of file
    while ((ch = fgetc(obj)) != EOF) {
        if (ch == 'H') {   // Header record
            fscanf(obj, "%s %x %x", pname, &start, &length);
            printf("Program Name   : %s\n", pname);
            printf("Starting Addr  : %X\n", start);
            printf("Program Length : %X\n\n", length);
            locctr = start;
        }

        else if (ch == 'T') {   // Text record
            fscanf(obj, "%x %x", &start, &length);
            printf("Text Record -> Starting Addr: %X, Length: %X\n", start, length);
            locctr = start;

            // read object codes
            while ((ch = fgetc(obj)) != '\n' && ch != EOF) {
                if (ch == ' ') continue;    // skip spaces
                ch1 = fgetc(obj);           // read next hex digit
                printf("%X\t%c%c\n", locctr++, ch, ch1);
            }
            printf("\n");
        }

        else if (ch == 'E') {   // End record
            fscanf(obj, "%x", &start);
            printf("End Record -> Program Execution Starts at: %X\n", start);
        }
    }

    fclose(obj);
    return 0;
}